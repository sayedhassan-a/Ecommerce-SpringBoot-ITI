<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orders List</title>
  <script src="../assets/js/forbiddenAdmin.js"></script>
  <link rel="stylesheet" href="../assets/css/bootstrap.css">
  <link rel="stylesheet" href="../assets/css/all.css">
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    body {
      display: flex;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1e1e2f; /* Dark background for body */
      color: #f4f4f4; /* Light text color */
    }

    /* Sidebar Styling */
    .sidebar {
      width: 80px; /* Collapsed width */
      height: 100vh;
      background-color: #1c1c2e; /* Dark background for sidebar */
      color: #f4f4f4; /* Light text color */
      position: fixed;
      transition: width 0.3s ease; /* Smooth transition for expanding */
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
      overflow: hidden; /* Hide overflow for smooth expand effect */
      z-index: 1000; /* Ensures sidebar is above content */
    }

    .sidebar:hover {
      width: 250px; /* Expanded width */
    }

    .sidebar .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem 1rem;
            background-color: #28293d;
            font-weight: bold;
            position: relative;
            transition: all 0.3s ease;
        }

    /* Logo image */
    .sidebar .logo img {
      width: 40px; /* Adjust logo size */
      height: auto;
      transition: opacity 0.3s ease; /* Smooth transition for hover effect */
    }
    /* Logo image */
    .sidebar .logo img.expand {
      width: 0px; /* Adjust logo size */
    }

    /* Image when expanded */
    .sidebar:hover .logo img.expand {
      opacity: 1; /* Show full logo on hover */
      width: 120px;
    }
    .sidebar:hover .collapsed {
      opacity: 0; /* Show full logo on hover */
    }


    /* Image when collapsed */
    .sidebar .logo img.expand {
      opacity: 0; /* Hide the expanded logo when collapsed */
    }

    .sidebar nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar nav ul li {
      position: relative;
    }

    .sidebar nav ul li a {
      display: flex;
      align-items: center;
      color: #f4f4f4; /* Light text color */
      padding: 1rem 1.5rem;
      text-decoration: none;
      font-size: 1rem;
      transition: background 0.3s ease;
    }

    .sidebar nav ul li a:hover {
      background-color: #3a3b5a; /* Darker background on hover */
      cursor: pointer;
    }

    .sidebar nav ul li a i {
      font-size: 1.5rem;
      margin-right: 1rem;
      transition: transform 0.3s ease, color 0.3s ease;
    }

    .sidebar nav ul li a span {
      opacity: 0;
      transition: opacity 0.3s ease;
      white-space: nowrap;
    }

    .sidebar:hover nav ul li a span {
      opacity: 1;
    }

    .sidebar nav ul li a:hover i {
      transform: scale(1.1);
      color: #f1c40f; /* Example hover color */
    }

    /* Main Content Area */
    .main-content {
      margin-left: 80px; /* Initial space for collapsed sidebar */
      padding: 2rem;
      transition: margin-left 0.3s ease, width 0.3s ease;
      width: calc(100% - 80px); /* Width accounting for collapsed sidebar */
      background-color: #2a2a3a; /* Dark background for main content */
      border-radius: 8px; /* Rounded corners */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .sidebar:hover ~ .main-content {
      margin-left: 250px; /* Adjust for expanded sidebar */
      width: calc(100% - 250px); /* Adjust width for expanded sidebar */
    }

    /* Section Gap */
    .section_gap {
      margin: 20px 0;
      padding: 20px;
      border-radius: 8px;
      background: #2a2a3a; /* Dark background for section gaps */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .header_area {
      background: #343a40; /* Dark header background */
      padding: 20px;
      color: #ffffff;
      text-align: center;
    }

    h4 {
      color: #ffffff; /* Light text for headers */
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      color: #ffffff; /* Light text for labels */
    }

    .btn {
      border-radius: 50px;
      transition: background-color 0.3s, transform 0.3s;
    }

    .btn-primary {
      background-color: #007bff; /* Bootstrap primary color */
      border: none;
    }

    .btn-primary:hover {
      background-color: #0056b3; /* Darker primary color on hover */
      transform: translateY(-2px);
    }

    .btn-secondary {
      background-color: #6c757d; /* Bootstrap secondary color */
      border: none;
    }

    .btn-secondary:hover {
      background-color: #5a6268; /* Darker secondary color on hover */
      transform: translateY(-2px);
    }

    table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      text-align: left;
      padding: 15px;
      border-bottom: 1px solid #4b4b61; /* Darker border for table rows */
    }

    th {
      background-color: #007bff; /* Darker background for table header */
      color: white;
    }

    tr:hover {
      background-color: #3a3b5a; /* Dark hover effect for table rows */
      transition: background-color 0.2s ease;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        position: static; /* Change position for smaller screens */
        width: 100%; /* Full width for sidebar */
        height: auto; /* Auto height for sidebar */
      }

      .main-content {
        margin-left: 0; /* Reset margin for small screens */
        width: 100%; /* Full width for main content */
      }

      .section_gap {
        padding: 10px;
      }
    }
  </style>
</head>

<body>
  <aside class="sidebar">
    <a href="/dashboard/list-product.html">
      <div class="logo">
          <img src="../assets/img/logo4.png" alt="Logo" class="expand"> <!-- Image when expanded -->
        <img src="../assets/img/smallLogo.png"  alt="Logo" class="collapsed"> <!-- Image when collapsed -->
      </div>
    </a>
    <nav>
        <ul>
          <li><a href="/dashboard/list-customer.html"><i class="fas fa-address-book"></i><span style="margin-left: 10px;">Customers</span></a></li>
          <li><a href="/dashboard/list-product.html"><i class="fas fa-box"></i><span style="margin-left: 10px;">Products</span></a></li>
          <li><a href="/dashboard/list-orders.html"><i class="fas fa-shopping-cart"></i><span style="margin-left: 10px;">Orders</span></a></li>
          <li><a onclick="localStorage.removeItem('adminToken');location.href = '/web/index.html'"><i class="fas fa-power-off"></i><span style="margin-left: 10px;">Logout</span></a></li>
        </ul>
    </nav>
</aside>

  <div class="main-content">
    <section class="container section_gap">
      <h3>Orders List</h3>
      <div style="display: flex; flex-direction: row;">
        <!-- Sidebar for Filters -->
        <aside class="col-md-3">
          <h4>Filter Orders</h4>
          <form id="filterForm">
            <!-- Date Range -->
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" class="form-control mb-2">
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" class="form-control mb-2">

            <!-- Price Range -->
            <label for="minPrice">Min Price (EGP):</label>
            <input type="number" id="minPrice" class="form-control mb-2" min="0">
            <label for="maxPrice">Max Price (EGP):</label>
            <input type="number" id="maxPrice" class="form-control mb-2" min="0">

            <!-- Order Status -->
            <label>Order Status:</label><br>
            <div>
              <input type="checkbox" value="PLACED" id="statePlaced">
              <label for="statePlaced">Placed</label><br>
              <input type="checkbox" value="CONFIRMED" id="stateConfirmed">
              <label for="stateConfirmed">Confirmed</label><br>
              <input type="checkbox" value="DELIVERED" id="stateDelivered">
              <label for="stateDelivered">Delivered</label><br>
              <input type="checkbox" value="CANCELLED" id="stateCanceled">
              <label for="stateCanceled">Canceled</label><br>
            </div>

            <!-- Customer ID -->
            <label for="customerId">Customer ID:</label>
            <input type="number" id="customerId" class="form-control mb-2" min="0">

            <!-- Payment Method -->
            <label>Payment Method:</label><br>
            <div>
              <input type="checkbox" value="CREDIT_CARD" id="paymentCreditCard">
              <label for="paymentCreditCard">Credit Card</label><br>
              <input type="checkbox" value="PAYPAL" id="paymentPayPal">
              <label for="paymentPayPal">PayPal</label><br>
            </div>

            <!-- Filter Button -->
            <button type="button" class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
          </form>
        </aside>

        <!-- Orders Table -->
        <div class="col-md-9">
          <table class="table table-dark table-striped">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer ID</th>
                <th>Date</th>
                <th>Total Amount (EGP)</th>
                <th>Payment Method</th>
                <th>State</th>
              </tr>
            </thead>
            <tbody id="ordersTableBody">
              <!-- Dynamic Order Rows will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </div>



<script src="../assets/js/vendor/jquery-2.2.4.min.js"></script>
<script src="../assets/js/vendor/bootstrap.min.js"></script>
<script src="../assets/js/main.js"></script>

<script>
  var token = localStorage.getItem("adminToken");

  // Function to fetch orders from the API and populate the table
  async function loadOrders(page = 0, size = 10, filters = {}) {
    try {
      let url = `https://improved-ghastly-midge.ngrok-free.app/api/v1/orders/admin?page=${page}&size=${size}`;

      // Append filter parameters if provided
      if (filters.startDate) url += `&startDate=${filters.startDate}T00:00`;
      if (filters.endDate) url += `&endDate=${filters.endDate}T23:59:59`;
      if (filters.minPrice) url += `&minPrice=${filters.minPrice}`;
      if (filters.maxPrice) url += `&maxPrice=${filters.maxPrice}`;
      if (filters.customerId) url += `&customerId=${filters.customerId}`;
      if (filters.states) {
        filters.states.forEach(state => url += `&states=${state}`);
      }
      if (filters.paymentMethods) {
        filters.paymentMethods.forEach(method => url += `&paymentMethods=${method}`);
      }

      const response = await fetch(url, {
        method: "GET",
        headers:{
          Authorization:`Bearer ${token}`,
          "ngrok-skip-browser-warning":"abc"}
      });

      if (!response.ok) throw new Error('Network response was not ok');

      const data = await response.json();
      populateTable(data.content);
      populatePagination(data.page.number + 1, data.page.totalPages);
    } catch (error) {
      console.error('Error loading orders:', error);
    }
  }

  // Apply filters function
  function applyFilters(page = 0, size = 10) {
    const filters = {
      startDate: document.getElementById('startDate').value,
      endDate: document.getElementById('endDate').value,
      minPrice: document.getElementById('minPrice').value,
      maxPrice: document.getElementById('maxPrice').value,
      customerId: document.getElementById('customerId').value,
      states: Array.from(document.querySelectorAll('input[type="checkbox"][id^="state"]:checked')).map(opt => opt.value),
      paymentMethods: Array.from(document.querySelectorAll('input[type="checkbox"][id^="payment"]:checked')).map(opt => opt.value),
    };

    loadOrders(page, size, filters);
  }

  // Function to dynamically populate the table with orders
  function populateTable(orders) {
    const tableBody = document.getElementById('ordersTableBody');
    tableBody.innerHTML = ''; // Clear the table first

    orders.forEach(order => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${order.id}</td>
        <td>${order.customerId}</td>
        <td>${new Date(order.date).toLocaleDateString()}</td>
        <td>${order.totalPrice} EGP</td>
        <td>${order.paymentMethod}</td>
        <td>${order.state}</td>
        <td>
          <button class="btn btn-primary" onclick="viewOrder(${order.id})">View</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

  // Function to handle viewing a specific order (redirect)
  function viewOrder(orderId) {
    window.location.href = `/dashboard/review-order.html?orderId=${orderId}`;
  }

  // Populate pagination
  function populatePagination(currentPage, totalPages) {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = ''; // Clear current pagination

    for (let i = 1; i <= totalPages; i++) {
      const li = document.createElement('li');
      li.className = `page-item ${i === currentPage ? 'active' : ''}`;
      li.innerHTML = `<a class="page-link" href="#" onclick="loadOrders(${i - 1})">${i}</a>`;
      pagination.appendChild(li);
    }
  }

  // Initial load
  document.addEventListener('DOMContentLoaded', () => loadOrders());
</script>
</body>
</html>
